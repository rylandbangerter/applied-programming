<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="AI Stat Predictor for Baseball Players" />
    <meta
      name="keywords"
      content="Baseball, AI, Stat Predictor, Player Stats"
    />
    <meta name="author" content="Applied Programming Team" />
    <title>MBGPT</title>
    <!-- <script src="frontend.js"></script> -->
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="styles.css" />
    <script defer src="firebase_script.js" type="module"></script>
    <!-- <script src="frontend.js" defer></script> -->
  </head>

  <body>
    <!-- <div id="output-data"></div> -->
    <div id="parallax">
      <h1>MBGPT</h1>
    </div>
    <div class="main-page">
      <h3>
        Welcome to our AI Stat Predictor. Select the stat that you would like to
        predict and the name of the player that you want to predict it for.
      </h3>

      <div class="selection" id="stat-selection">
        <label for="stats">Choose a stat:</label>
        <select id="statsDropdown" name="stats">
          <option value="choose">Select one</option>
        </select>
      </div>
      <div class="selection" id="player-selection">
        <label for="players">Choose a player:</label>
        <select id="playerDropdown">
          <!-- firebase_script.js automatically grabs players from Firebase database -->
          <option value="choose">Select one</option>
        </select>
      </div>
      <div class="selection" id="opponent-selection">
        <label for="opponents">Choose an opponent:</label>
        <select id="opponentDropdown">
          <!-- firebase_script.js automatically grabs players from Firebase database -->
          <option value="choose">Select one</option>
        </select>
      </div>
      <div>
        <button onclick="getPrediction()">Predict</button>
        <p id="result"></p>
      </div>
      <img
        id="moneyball"
        src="moneyball.jpg"
        alt="Moneyball"
        width="300"
        height="200"
      />
      <div id="predictionResults"></div>
    </div>
    <script type="module" src="displayData.js">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCL_Po7HXEyKAKDsLvoSCNy-Bb9NPmFxCo",
        authDomain: "moneyball-a1cab.firebaseapp.com",
        projectId: "moneyball-a1cab",
        storageBucket: "moneyball-a1cab.firebasestorage.app",
        messagingSenderId: "1002557739869",
        appId: "1:1002557739869:web:a035e6b37226a8e7560eb4",
        measurementId: "G-Q25HCXCHC6",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      async function displayData() {
        const outputDiv = document.getElementById("output-data");
        try {
          const querySnapshot = await getDocs(collection(db, "gameStats"));
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const dataElement = document.createElement("p");
            dataElement.textContent = JSON.stringify(data);
            outputDiv.appendChild(dataElement);
          });
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      displayData();

      async function getPrediction() {
        const stat = document.getElementById("statsDropdown").value;
        const player = document.getElementById("playerDropdown").value;
        const opponent = document.getElementById("opponentDropdown").value;
        const resultDiv = document.getElementById("predictionResults");
        const formattedPlayer = player
          .replace(/_/g, " ")
          .replace(/\b\w/g, (c) => c.toUpperCase());
        resultDiv.innerHTML = `<strong>${formattedPlayer} — ${stat} Prediction vs ${opponent}:</strong><br>`;

        if ([stat, player, opponent].includes("choose")) {
          resultDiv.textContent = "Please select all fields before predicting.";
          return;
        }

        try {
          const response = await fetch(
            "https://predictionbackend-m35t.onrender.com/predict",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ stat, player, opponent }),
            }
          );

          const data = await response.json();

          if (data.error) {
            resultDiv.textContent = `Server error: ${data.error}`;
            return;
          }

          const formattedPlayer = player
            .replace(/_/g, " ")
            .replace(/\b\w/g, (c) => c.toUpperCase());
          resultDiv.innerHTML = `<strong>${formattedPlayer} — ${stat} Prediction vs ${opponent}:</strong><br>`;
          for (const [key, value] of Object.entries(data)) {
            resultDiv.innerHTML += `${key}: ${value}<br>`;
          }
        } catch (err) {
          resultDiv.textContent = "Prediction failed. Check console.";
          console.error("Fetch error:", err);
        }
      }
      window.getPrediction = getPrediction;
    </script>
  </body>
</html>
